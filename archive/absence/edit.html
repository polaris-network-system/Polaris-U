<section class="m-3">
    <div class="hero is-info">
        <div class="hero-body">
            <p class="title">欠席情報更新</p>
        </div>
    </div>
    <div class="m-6">
        <!-- フォームの部品 -->
        <div class="my-4">
            <label for="id">欠席申請ID</label>
            <input type="number" id="id" name="id" class="input" placeholder="照会画面に表示される申請IDを入力してください" />
        </div>
        <input type="submit" value="照会" class="button is-outline is-info" id="btn_inquiry" /><br /><br />
        <strong id="result" class="has-text-danger"></strong>
        <div class="my-4">
            <label for="number">固有学籍番号</label>
            <input type="text" id="number" class="input" disabled />
        </div>
        <div class="my-4">
            <label for="name">欠席申請者</label>
            <input type="text" id="name" class="input" disabled />
        </div>
        <div class="my-4">
            <label for="type">種別</label>
            <input type="text" id="type" class="input" disabled />
        </div>
        <div class="my-4">
            <label for="activity">欠席予定活動</label>
            <input type="text" id="activity" class="input" disabled />
        </div>
        <div class="my-4">
            <label for="content">特記事項</label><br />
            <textarea type="text" id="content" class="input" style="height: 150px" disabled></textarea>
        </div>
        <input type="submit" value="削除" class="button is-outline is-danger" id="btn" disabled />
    </div>
</section>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
    var btn_inquiry = document.getElementById('btn_inquiry');
    btn_inquiry.addEventListener('click', function () {
        btn_inquiry.value = '照会中...';
        $(function () {
            google.script.run.withSuccessHandler(showThings_inquiry).getData('absence_edit_inquery', document.getElementById('id').value);
        });
    });
    function showThings_inquiry(things) {
        if (things[0] == 'bad') {
            document.getElementById('result').textContent = '入力されたIDに該当する申請がありません';
            document.getElementById('number').value = '';
            document.getElementById('name').value = '';
            document.getElementById('type').value = '';
            document.getElementById('activity').value = '';
            document.getElementById('content').value = '';
            btn_inquiry.value = '照会';
            document.getElementById('btn').disabled = true;
        } else if (things[0] == 'ok') {
            document.getElementById('result').textContent = '';
            document.getElementById('number').value = things[1][0][0];
            document.getElementById('name').value = things[1][0][1];
            document.getElementById('type').value = things[1][0][2];
            document.getElementById('activity').value = things[1][0][3] + ' ' + things[1][0][4];
            document.getElementById('content').value = things[1][5];
            btn_inquiry.value = '照会';
            document.getElementById('btn').disabled = false;
        } else if (things[0] == 'notallow') {
            document.getElementById('result').textContent = 'このIDの申請を表示する権限がありません';
            document.getElementById('number').value = '';
            document.getElementById('name').value = '';
            document.getElementById('type').value = '';
            document.getElementById('activity').value = '';
            document.getElementById('content').value = '';
            btn_inquiry.value = '照会';
        }
    }
</script>
<script>
    var btn = document.getElementById('btn');
    btn.addEventListener('click', function () {
        btn.value = 'リクエスト送信中...';
        $(function () {
            google.script.run.withSuccessHandler(showThings).sendData('absence_delete', document.getElementById('id').value);
        });
    });
    function showThings(things) {
        message = '削除しました';
        window.alert(message);
        btn.value = '削除';
        document.getElementById('id').value = '';
        document.getElementById('number').value = '';
        document.getElementById('name').value = '';
        document.getElementById('type').value = '';
        document.getElementById('activity').value = '';
        document.getElementById('content').value = '';
    }
</script>
