<section class="m-3">
    <div class="hero is-info">
        <div class="hero-body">
            <p class="title">欠席登録</p>
        </div>
    </div>
    <div class="m-6">
        <!-- フォームの部品 -->
        <div class="my-4">
            <label for="date">活動日</label>
            <input type="date" id="date" name="date" class="input" />
        </div>
        <input type="submit" value="照会" class="button is-outline is-info" id="btn_inquiry" />
        <br /><br />
        <strong id="result" class="has-text-danger"></strong>
        <br />
        <div class="my-4">
            <label>活動</label><br />
            <div class="select">
                <select id="activity"></select>
            </div>
        </div>
        <input type="submit" value="照会" class="button is-outline is-info" id="btn_inquiry" />
        <div class="my-4">
            <label for="time">時間</label>
            <input type="text" id="time" name="time" class="input" />
        </div>
        <div class="my-4">
            <label for="place">場所</label>
            <input type="text" id="place" name="place" class="input" />
        </div>
        <div class="my-4">
            <label for="message">備考</label>
            <input type="text" id="message" name="message" class="input" placeholder="特記事項を入力" />
        </div>
        <input type="submit" value="変更する" class="button is-outline is-info" id="btn_update" disabled />
        <input type="submit" value="削除する" class="button is-outline is-danger" id="btn_delete" disabled />
    </div>
</section>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
    var btn_inquiry = document.getElementById('btn_inquiry');
    btn_inquiry.addEventListener('click', function () {
        btn_inquiry.value = '照会中...';
        $(function () {
            google.script.run.withSuccessHandler(showThings_inquiry).getData('absence_inquery', document.getElementById('date').value);
        });
    });
    function showThings_inquiry(things) {
        if (things[0] == 'bad') {
            document.getElementById('result').textContent = '入力された日付に該当する活動がありません';
            btn_inquiry.value = '照会';
            document.getElementById('activity').textContent = '';
            document.getElementById('btn').disabled = true;
        } else {
            document.getElementById('result').textContent = '';
            document.getElementById('activity').textContent = '';
            for (i = 1; i < things[1].length; i++) {
                var optionele = document.createElement('option');
                title = String(things[1][i][3]) + ' ' + String(things[1][i][4]);
                optionele.appendChild(document.createTextNode(title));
                optionele.setAttribute('value', title);
                optionele.setAttribute('name', i);
                document.getElementById('activity').appendChild(optionele);
            }
            btn_inquiry.value = '照会';
            document.getElementById('btn').disabled = false;
        }
    }
</script>
<script>
    var btn_inquiry = document.getElementById('btn_inquiry_get');
    btn_inquiry.addEventListener('click', function () {
        btn_inquiry.value = '照会中...';
        $(function () {
            google.script.run.withSuccessHandler(showThings_inquiry).getData('schedule_inquery', document.getElementById('date').value, document.getElementById('activity').name);
        });
    });
    function showThings_inquiry(things) {
        if (things[0] == 'bad') {
            document.getElementById('result').textContent = '';
            btn_inquiry.value = '照会';
            document.getElementById('activity').textContent = '';
            document.getElementById('btn').disabled = true;
        } else {
            document.getElementById('result').textContent = '';
            document.getElementById('activity').textContent = '';
            for (i = 1; i < things[1].length; i++) {
                var optionele = document.createElement('option');
                title = String(things[1][i][3]) + ' ' + String(things[1][i][4]);
                optionele.appendChild(document.createTextNode(title));
                optionele.setAttribute('value', title);
                optionele.setAttribute('name', i);
                document.getElementById('activity').appendChild(optionele);
            }
            btn_inquiry.value = '照会';
            document.getElementById('btn').disabled = false;
        }
    }
</script>
<script>
    var btn = document.getElementById('btn_delete');
    btn.addEventListener('click', function () {
        document.getElementById('btn_delete').value = 'リクエスト送信中...';
        $(function () {
            google.script.run.withSuccessHandler(showThingsdlt).sendData('schedule_delete', document.getElementById('id').value);
        });
    });
    function showThingsdlt(things) {
        message = '削除しました';
        window.alert(message);
        document.getElementById('btn_delete').value = '削除';
        document.getElementById('date').value = '';
        document.getElementById('time').value = '';
        document.getElementById('place').value = '';
        document.getElementById('message').value = '';
        document.getElementById('activity').value = '';
        document.getElementById('btn_delete').disabled = true;
        document.getElementById('btn_update').disabled = true;
    }
</script>
<script>
    var btn = document.getElementById('btn_update');
    btn.addEventListener('click', function () {
        btn.value = 'リクエスト送信中...';
        $(function () {
            google.script.run
                .withSuccessHandler(showThingsup)
                .sendData(
                    'schedule_update',
                    document.getElementById('date').value,
                    document.getElementById('activity').name,
                    document.getElementById('time').value,
                    document.getElementById('place').value,
                    document.getElementById('message').value
                );
        });
    });
    function showThingsup(things) {
        message = '更新しました';
        window.alert(message);
        btn.value = '情報更新';
        document.getElementById('date').value = '';
        document.getElementById('time').value = '';
        document.getElementById('place').value = '';
        document.getElementById('message').value = '';
        document.getElementById('activity').value = '';
        document.getElementById('btn_delete').disabled = true;
        document.getElementById('btn_update').disabled = true;
    }
</script>
