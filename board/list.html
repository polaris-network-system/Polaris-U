<section class="m-3">
</section>
<section class="m-3">
  <div class="is-hidden-desktop is-hidden-tablet select is-fullwidth">
    <select id="select_menu">
      <option>loading</option>
    </select>
  </div>
  <div class="columns">
    <div class="submenu column is-3 is-hidden-mobile mr-6" style="border-right: 1px solid #6c848d; height: 70vh;">
        <aside class="menu">
          <p id="loading" class="has-text-centered"><b>loading</b></p>
          <ul class="menu-list" id="side_menu">
          </ul>
        </aside>
      </div>
    <div class="column m-3">
      <p id="detail_loading" class="has-text-centered" hidden><b>loading</b></p>
      <div id="data_area" hidden>
        <div class="columns">
          <div class="column">
            <p id="title" class="is-size-3"><b>タイトル</b></p>
            <p id="author" class="is-size-6">作成者</p>
            <p>作成：<c id="made" class="is-size-6"></c><br>最終更新：<c id="update" class="is-size-6"></c></p>
          </div>
          <div class="column is-one-third">
            <a class="button is-rounded is-info m-1" id="edit">編集</a>
            <a class="button is-rounded is-danger m-1" id="delete">削除</a>
          </div>
        </div>
          <section>
            <p>ステージ準備：</p>
            <p id="pre"></p>
            <p>全体の流れ：</p>
            <p id="ope"></p>
            <p>備考：</p>
            <p id="message"></p>
            <p>変更履歴：</p>
            <p id="history"></p>
          </section>
        </div>
      </div>
    </div>
</section>
<script
  src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
</script>
<script>
  // The code in this function runs when the page is loaded.
  $(function() {
    google.script.run.withSuccessHandler(showEvents)
        .getData("event_list");
  });

  function showEvents(things) {
    var select_menu = document.getElementById('select_menu')
    var side_menu = document.getElementById('side_menu')
    document.getElementById('loading').setAttribute("hidden","")
    document.getElementById('select_menu').textContent = ""
    select_ele = document.createElement("option")
    select_ele.textContent = "選択してください"
    select_menu.appendChild(select_ele)
    for (var i = 1; i < things.length; i++) {
      select_ele = document.createElement("option")
      select_ele.setAttribute("value",i)
      select_ele.textContent = things[i]
      select_menu.appendChild(select_ele)

      side_ele = document.createElement("li")
      side_li_ele = document.createElement("a")
      side_li_ele.setAttribute("class","has-text-centered m-2 is-size-5")
      side_li_ele.setAttribute("onclick",("click_eventlist(" + i + ")"))
      side_li_ele.setAttribute("href","javascript:void(0)")
      side_li_ele.setAttribute("id",i)
      side_li_ele.textContent = things[i]
      side_ele.appendChild(side_li_ele)
      side_menu.appendChild(side_ele)
    }
  }

  $(function() {
    let select = document.getElementById("select_menu");
    select.onchange = event => { 
      document.getElementById("detail_loading").removeAttribute("hidden")
      id = document.getElementById("select_menu").value
      google.script.run.withSuccessHandler(showDetails)
        .getData("event_detail",id);
    }
  });

  function click_eventlist(id) {
    document.getElementById("detail_loading").removeAttribute("hidden")
    google.script.run.withSuccessHandler(showDetails)
      .getData("event_detail",id);
  };

  function showDetails(things) {
    var data_area = document.getElementById('data_area')
    document.getElementById("detail_loading").setAttribute("hidden","")
    data_area.removeAttribute("hidden","")
    document.getElementById('title').textContent = things[0][0]
    document.getElementById('author').textContent = things[0][1]
    document.getElementById('made').textContent = things[0][2]
    document.getElementById('update').textContent = things[0][3]
    document.getElementById('pre').textContent = things[0][4]
    document.getElementById('ope').textContent = things[0][5]
    document.getElementById('message').textContent = things[0][6]
    cutcontent = things[0][7].split(",")
    content_text = ""
    for(var i=0;i<cutcontent.length;i++){
      content_text += cutcontent[i] + "<br>"
    }
    document.getElementById('history').innerHTML = content_text
  }
</script>